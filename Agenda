#include <sys/types.h>
#include <sys/stat.h>
#include <stdio.h>
#include <unistd.h>
#include <fcntl.h>
#include <string.h>

int main(int argc, char* argv[]){

	if(argc < 2){
		write(0,"ERRO de introducao\n",sizeof("ERRO de introducao\n"));
		return -1;
	
	}

	mkfifo("fifo",0666);

	int Rfifo = open("fifo",O_RDONLY);

	int ficheiro = open(argv[1],O_WRONLY|O_CREAT|O_APPEND,0666);

	char buf ;

	if(Rfifo == -1){
		write(0,"ERRO ao abrir o fifo\n",sizeof("ERRO ao abrir o fifo\n"));
		return -1;
	}
	if(ficheiro == -1){
		write(0,"ERRO ao abrir o ficheiro\n",sizeof("ERRO ao abrir o ficheiro\n"));
		return -1;
	}


	char *tipo;

	while(
		read(Rfifo,&buf,1) != 0){
	//close(Rfifo);
	//	tipo = strcat(&buf,"\n");
	//	printf("%s\n", tipo);
	//}

	//	if (tipo == "-a"){

	//while(read(Rfifo,&buf,1) != 0){
		write(ficheiro,&buf,1);
	//}
	//}
		
	//else{
		//write(0,"cock&balls",sizeof("cock&balls"));
		}


	close(Rfifo);
	close(ficheiro);
	return 0;
}
