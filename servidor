#include <sys/types.h>
#include <sys/stat.h>
#include <stdio.h>
#include <unistd.h>
#include <fcntl.h>
#include <string.h>

int main(int argc, char* argv[]){

	if(argc < 2){
		write(0,"ERRO de introducao\n",sizeof("ERRO de introducao\n"));
		return -1;

	}

	mkfifo("fifo",0666);

	int Rfifo = open("fifo",O_RDONLY);

	int ficheiro = open(argv[1],O_WRONLY|O_CREAT|O_APPEND,0666);

	char buf[10] ;

	if(Rfifo == -1){
		write(0,"ERRO ao abrir o fifo\n",sizeof("ERRO ao abrir o fifo\n"));
		return -1;
	}
	if(ficheiro == -1){
		write(0,"ERRO ao abrir o ficheiro\n",sizeof("ERRO ao abrir o ficheiro\n"));
		return -1;
	}

int nbytes;
	while((nbytes = read(Rfifo, buf, sizeof buf - 1)) > 0 ) // fd is the opened pipe
	{
	  buf[nbytes - 1] = '\0';
		if(strcmp(buf,"-a")==0){
	            printf("Deu");
							write(ficheiro,&buf,1);
	          }
	          if(strcmp(buf,"o")==0){
	            printf("NÃ£o deu");
	          }
	}

/*
	while(read(Rfifo,&buf,1) != 0)
	{
		write(ficheiro,&buf,1);
	}
*/

	close(Rfifo);
	close(ficheiro);
	return 0;
}
