	#include <sys/types.h>
	#include <sys/stat.h>
	#include <stdio.h>
	#include <unistd.h>
	#include <fcntl.h>
	#include <string.h>

	
	int comparar();


	int main(int argc, char* argv[]){

		if(argc < 2){
			write(0,"ERRO de introducao\n",sizeof("ERRO de introducao\n"));
			return -1;

		}

		mkfifo("fifo",0666);

		int ficheiro = open(argv[1],O_WRONLY|O_CREAT|O_APPEND,0666);

		int Rfifo = open("fifo",O_RDONLY);

		char buf;

		if(Rfifo == -1){
			write(0,"ERRO ao abrir o fifo\n",sizeof("ERRO ao abrir o fifo\n"));
			return -1;
		}
		if(ficheiro == -1){
			write(0,"ERRO ao abrir o ficheiro\n",sizeof("ERRO ao abrir o ficheiro\n"));
			return -1;
		}

		if (comparar())
		{
		
	
		while(read(Rfifo,&buf,1) != 0)
		{
			write(ficheiro,&buf,1);
		}
	}

		close(Rfifo);
		close(ficheiro);
		return 0;
	
}


		int comparar(){

		int nbytes;
		char lol[10] ;

		mkfifo("fifotipo",0666);
		int Rfifotipo = open("fifotipo",O_RDONLY);

		while((nbytes = read(Rfifotipo,lol, sizeof lol - 1)) > 0 ) // fd is the opened pipe
		{
			printf("%s\n", lol );

		  lol[nbytes - 1] = '\0';
			printf("%s\n", lol);
			if(strcmp(lol,"-a")==0){
			    printf("Deu");
			    return 1;
			  }
			 else{
			    printf("O VALOR N Ã‰ VALido");
			  }
		}
		close(Rfifotipo);

	}
